<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" href="styles.css">
	<link rel="preload" href="styles-extra.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<link rel="preload" href="css/fontawesome.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> 
	<link rel="preload" href="css/solid.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
	<meta name="theme-color" content="#7B8092">
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
	<link rel="apple-touch-icon" href="apple-touch-icon.png" />
	<link rel="apple-touch-icon" sizes="57x57" href="apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon" sizes="76x76" href="apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png" />
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png" />


<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">

 <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/12.9__iPad_Pro_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/11__iPad_Pro__10.5__iPad_Pro_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/10.5__iPad_Air_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/10.2__iPad_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/iPhone_11__iPhone_XR_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/12.9__iPad_Pro_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/11__iPad_Pro__10.5__iPad_Pro_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/10.5__iPad_Air_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/10.2__iPad_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/iPhone_11__iPhone_XR_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png">


    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <link rel="manifest" href="manifest.json">
    <meta charset="utf-8">
	<meta name="description" content="Simple and free TIVA simulator">
    <meta name="keywords" content="simtiva, tiva, tci, free, simulator, calculator, terence, luk, propofol, remifentanil, alfentanil, app, smartphones, apple, android">
    <meta name="author" content="Terence Luk">
    <title>SimTIVA | Free TIVA Simulation App to Simulate Target-Controlled Infusion | Simple TCI Calculator</title>
<script defer src="https://cloud.umami.is/script.js" data-website-id="fe14ba98-f4c0-4536-94fa-9a0a4c1ed75e"></script>
</head>
<body class="" id="windowbody">
		<div id="rescuebuttons">
			<a class="button frontpage"  onclick="displayModalOptions();">
			<svg class="iconsvg sliders" viewBox="0 0 512 512"><path d="M0 416c0 17.7 14.3 32 32 32l54.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 448c17.7 0 32-14.3 32-32s-14.3-32-32-32l-246.7 0c-12.3-28.3-40.5-48-73.3-48s-61 19.7-73.3 48L32 384c-17.7 0-32 14.3-32 32zm128 0a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM320 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm32-80c-32.8 0-61 19.7-73.3 48L32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l246.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48l54.7 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-54.7 0c-12.3-28.3-40.5-48-73.3-48zM192 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm73.3-64C253 35.7 224.8 16 192 16s-61 19.7-73.3 48L32 64C14.3 64 0 78.3 0 96s14.3 32 32 32l86.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 128c17.7 0 32-14.3 32-32s-14.3-32-32-32L265.3 64z"/></svg>
			Options</a>
			<a class="button frontpage"  onclick="rescue();">
			<svg class="iconsvg life-ring" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm173.7 119.6l-63.4 63.4c-11-18.6-26.7-34.3-45.3-45.3l63.4-63.4a218.4 218.4 0 0 1 45.3 45.3zM256 352c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96zM127.6 82.3l63.4 63.4c-18.6 11-34.3 26.7-45.3 45.3l-63.4-63.4a218.4 218.4 0 0 1 45.3-45.3zM82.3 384.4l63.4-63.4c11 18.6 26.7 34.3 45.3 45.3l-63.4 63.4a218.4 218.4 0 0 1 -45.3-45.3zm302.1 45.3l-63.4-63.4c18.6-11 34.3-26.7 45.3-45.3l63.4 63.4a218.4 218.4 0 0 1 -45.3 45.3z"/></svg>
			Rescue</a>
			<a class="button frontpage"  onclick="load();">
			<svg class="iconsvg save" viewBox="0 0 448 512"><path d="M433.9 129.9l-83.9-83.9A48 48 0 0 0 316.1 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V163.9a48 48 0 0 0 -14.1-33.9zM224 416c-35.3 0-64-28.7-64-64 0-35.3 28.7-64 64-64s64 28.7 64 64c0 35.3-28.7 64-64 64zm96-304.5V212c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12V108c0-6.6 5.4-12 12-12h228.5c3.2 0 6.2 1.3 8.5 3.5l3.5 3.5A12 12 0 0 1 320 111.5z"/></svg>
			Load file</a>
		</div>
		<!--startmodal-->
		<div id="logo">
			<div style="border-bottom:1px solid #333;width:calc(50% - 100px);display:inline-block"></div><div style="width:200px;font-stretch:110%;text-align:center;font-weight:bold;opacity:0.2;letter-spacing:10px;display:inline-block;transform:translate(5px, 5px)">SIMTIVA</div><div style="border-bottom:1px solid #333;width:calc(50% - 100px);display:inline-block"></div>
		</div>
		<div id="modalInitial" class="modal">
			<div class="modal-content" id="modalInitialcontent">
				<div class="modal-header">Enter patient data<!--<span class="close notcondensed" onClick="hideallmodal()">&times;</span>--><img onclick="displayAbout();" src="apple-touch-icon-180x180.png" style="position:absolute;right:6px;width:44px;cursor:pointer"></div>
				<div class="modal-body">
					<div class="paedimode_selector">
						<a class="button_paedimode active" id="paedimode0" onclick="switchpaedimode(0);">Adult</a><!--
						--><a class="button_paedimode" id="paedimode1" onclick="switchpaedimode(1);">Paediatric</a>
					</div>
					<table class="table-Init">
					<tr class="fr" id="row_age_adultmode">
						<td>Age (y) <i class="fas fa-question tooltip ring"><span class="tooltiptext" style="width: 80px; line-height:20px">0-100y</span></i></td>
						<td><input type="number" inputmode="decimal" id="inputAge" min="0.1" max="99" step="0.1" placeholder=" " onkeyup="sendToValidate(0)" required/></td>
					</tr>
					<tr class="fr" id="row_age_paedimode" style="display:none">
						<td>Age <i class="fas fa-question tooltip ring"><span class="tooltiptext">Actual chronological age</span></i></td>
						<td>
							<input type="number" inputmode="decimal" id="inputAgePaedi" placeholder=" " onkeyup="sendToValidate(0)"/>
							<select id="select_age_unit">
								<option value="d">Days</option>
								<option value="w">Weeks</option>
								<option value="m" selected>Months</option>
								<option value="y">Years</option>
							</select>
					</tr>
					<tr id="row_PMA_paedimode" style="display:none">
						<td><span style="letter-spacing: -0.5px">Post-menstrual age </span><i class="fas fa-question tooltip ring"><span class="tooltiptext" style="">Covariate for Eleveld; affects clearance in <6mo</span></i>
						</td>
						<td>
							<div id="PMA_td">
								<div id="PMA_entry"><input type="number" inputmode="decimal" id="inputPMA" placeholder=" "/>weeks</div>
								<div id="PMA_explanation" onclick="displayWarning('Post-menstrual age', 'Covariate for Eleveld model, affects clearance in <6 months old. Optional entry, omit for full term.')">What's this?</div>
							</div>
						</td>
					</tr>
					<tr>
						<td>Weight (kg) <i class="fas fa-question tooltip ring"><span class="tooltiptext">0-200kg, validation with BMI & weight-for-age</span></i></td>
						<td><input type="number" inputmode="decimal" id="inputBW" min="0.1" max="200" step="0.01" placeholder=" " onkeyup="sendToValidate(0)" required/></td>
					</tr>
					<tr id="row_height">
						<td>Height (cm) <i class="fas fa-question tooltip ring"><span class="tooltiptext">0-250cm, required for Schnider/Eleveld</span></i></td>
						<td><input type="number" inputmode="decimal" id="inputBH" min="0.1" max="250" step="0.1" placeholder=" " onkeyup="sendToValidate(0)" ></td>
					</tr>
					<tr id="row_gender"><td>Gender</td>
						<td>
							<select id="select_gender" onchange="sendToValidate(0)" >
								<option value="Male">Male</option>
								<option value="Female">Female</option>
							</select>
						</td>
					</tr>
					<tr><td>Model <i class="fas fa-question tooltip2 ring"><span class="tooltiptext">Paedfusor: for children. Marsh/Schnider/Minto: for adults.</span></i></td>
						<td>
							<select id="select_model" onchange="sendToValidate(0)" >
								
									<option value="Marsh">Propofol (Marsh)</option>
									<option value="Schnider">Propofol (Schnider)</option>
									<option value="Paedfusor">Propofol (Paedfusor)</option>
									<option value="Eleveld" selected>Propofol (Eleveld)</option>
								
									<option value="Minto">Remifentanil (Minto)</option>
									<option value="Eleveld-Remifentanil">Remifentanil (Eleveld)</option>
								
									<option value="Maitre">Alfentanil (Maitre)</option>
								
									<option value="Shafer">Fentanyl (Shafer)</option>

									<option value="Complex">Complex (Dual mode)</option>
								
							</select>

							<select id="select_model_paedi" onchange="sendToValidate(0)" style="display:none">
									<option value="Paedfusor">Propofol (Paedfusor)</option>
									<option value="Eleveld" selected>Propofol (Eleveld)</option>
									<option value="Eleveld-Remifentanil">Remifentanil (Eleveld)</option>
									<option value="Complex">Complex (Dual mode)</option>
							</select>
						</td>
					</tr>
					<tr id="row_eleveldopioid"><td style="letter-spacing:-0.5px">Concomitant opioid</span></td>
						<td>
							<select id="select_eleveldopioid">
								<option value="1">Yes, with opioid</option>
								<option value="0">No, propofol alone</option>
							</select>
						</td>
					</tr>
					<tr id="row_remidilution"><td style="letter-spacing:-0.5px">Concentration <span style="font-size: 85%">(mcg/ml)</span></td>
						<td>
							<select id="select_remidilution" onchange="change_remidilution(this.value)"> 
								<option value="5">5mcg/ml</option>
								<option value="10">10mcg/ml</option>
								<option value="20" selected>20mcg/ml</option>
								<option value="25">25mcg/ml</option>
								<option value="40">40mcg/ml</option>
								<option value="50">50mcg/ml</option>
								<option value="custom">Custom</option>
							</select>
							<div id="custom_remidilution" onclick="popup_dilution('remidilution','remifentanil')">
								<span id="remidilution">_</span>mcg/ml
							</div>
						</td>
					</tr>
					<tr id="row_alfendilution"><td style="letter-spacing:-0.5px">Concentration <span style="font-size: 85%">(mcg/ml)</span></td>
						<td>
							<select id="select_alfendilution" onchange="change_alfendilution(this.value)"> 
								<option value="100" selected>100mcg/ml</option>
								<option value="500">500mcg/ml</option>
								<option value="custom">Custom</option>
							</select>
							<div id="custom_alfendilution" onclick="popup_dilution('alfendilution','alfentanil')">
								<span id="alfendilution">_</span>mcg/ml
							</div>
						</td>
					</tr>
					<tr id="row_fen_weightadjusted"><td>Weight adjusted? <i class="fas fa-question tooltip3 ring"><span class="tooltiptext">If YES: PK model adjusted to BW according to Shibutani, 2004; recommended for obese.</span></i></td>
						<td>
							<select id="select_fen_weightadjusted">
								<option value="0" >No</option>
								<option value="1" selected>Yes</option>
							</select>
						</td>
					</tr>
					<tr id="row_fendilution"><td style="letter-spacing:-0.5px">Concentration <span style="font-size: 85%">(mcg/ml)</span></td>
						<td>
							<select id="select_fendilution" onchange="change_fendilution(this.value)">
								<option value="5">5mcg/ml</option>
								<option value="10" selected>10mcg/ml</option>
								<option value="20">20mcg/ml</option>
								<option value="25">25mcg/ml</option>
								<option value="50">50mcg/ml</option>
								<option value="custom">Custom</option>
							</select>
							<div id="custom_fendilution" onclick="popup_dilution('fendilution','fentanyl')">
								<span id="fendilution">_</span>mcg/ml
							</div>
						</td>
					</tr>
					<tr id="row_dexmededilution"><td>Drug dilution (mcg/ml)</td>
						<td>
							<input type="number" inputmode="decimal" id="inputDexmedeDilution" value="4">
						</td>
					</tr>
					</table>
					<div id="valCard" class="">
						<div id="valLeft"></div>
						<div id="valRight">
							<div style="position:relative">
								<div id="valRightContainer1" class="">
									Waiting for input.
								</div>
								<div id="valRightContainer2" class="valClose">
									BMI: <span id="bmiDisplay"></span><span id="bmiForAgeDisplay"></span>
									<div id="wfaDiv">Weight for age: <span id="wfaDisplay"></span>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div id="validationDisplay">
					</div>
					
					<div>
						<a class="button invert disabled" id="btn_initProceed">Proceed</a>
						<a class="button muted right" id="btn_disclaimer" onclick="displayDisclaimer();">Disclaimer</a>
						<a class="button muted right" id="btn_about" onclick="displayAbout2();">
							<svg class="iconsvg question-circle" viewBox="0 0 512 512"><path d="M504 256c0 137-111 248-248 248S8 393 8 256C8 119.1 119 8 256 8s248 111.1 248 248zM262.7 90c-54.5 0-89.3 23-116.5 63.8-3.5 5.3-2.4 12.4 2.7 16.3l34.7 26.3c5.2 3.9 12.6 3 16.7-2.1 17.9-22.7 30.1-35.8 57.3-35.8 20.4 0 45.7 13.1 45.7 33 0 15-12.4 22.7-32.5 34C247.1 238.5 216 254.9 216 296v4c0 6.6 5.4 12 12 12h56c6.6 0 12-5.4 12-12v-1.3c0-28.5 83.2-29.6 83.2-106.7 0-58-60.2-102-116.5-102zM256 338c-25.4 0-46 20.6-46 46 0 25.4 20.6 46 46 46s46-20.6 46-46c0-25.4-20.6-46-46-46z"/></svg>
						Help</a>
					</div>

			</div>
		</div>
	</div>
		<div id="modalScreen2" class="modal">
			<div class="modal-content" id="modalScreen2content">

				<div class="modal-header" id="page2title"><!--<span class="close notcondensed" onClick="hideallmodal()">&times;</span>--></div>
				<div class="modal-body">
					<div id="patientCard">
						<div id="patientLeft">
						</div>
						<div id="patientRight">
							<div id="patientRightUp"></div>
							<div id="patientRightDown" style="font-size:0.72rem; border-top:1px solid rgb(167 203 168); padding-top:3px; margin-top:3px; margin-right:5px"></div>
						</div>
						<div id="patientEdit">
							<div onclick="toPageOne();">EDIT</div>
						</div>
					</div>
					<div id="simplemodeselection" style="text-align:center; border:2px solid #ccc; border-radius:9px;position:relative;height:270px">
						<div id="page2intro" class="page2subheading">Choose one of the following:</div>
						<a id="page2cpt" class="page2subheading button huge" onclick="pageTwoFunction(0)"><span style="border-bottom:1px solid LightCoral">CP</span> TARGETING<i class="fas fa-tint fa-fw" style="color:LightCoral;"></i></a>
						
						<a id="page2cet" class="page2subheading button huge" onclick="pageTwoFunction(1)"><span style="border-bottom:1px solid green">CE</span> TARGETING<i class="fas fa-brain fa-fw" style="color:green;"></i></a>
						
						<a id="page2manual" class="page2subheading button huge" onclick="initmanual(0);hideallmodal();document.getElementById('card_controlpanel').style.display='block';">MANUAL<i class="fas fa-syringe fa-fw" style="color:rgb(81 203 238)"></i></a>
						
						<a id="page2IB" class="page2subheading button huge" onclick="initcetbolus(0);hideallmodal();">INTERMITTENT BOLUS<i class="fas fa-hourglass-half fa-fw" style="color:#c19f14"></i></a>
						<div id="page2maxrate" class="">
							<table class="table-Init" style="text-align:left">
								<tr class="fr" style="height:2rem">
									<td style="padding:0">Max bolus speed:</td>
									<td style="padding:0">
										<select id="page2selectmaxrate" onchange="sendToUpdateMax(this.value);">
											<option value="0" selected>Flash</option>
											<option value="1500">1500ml/h</option>
											<option value="1400">1400ml/h</option>
											<option value="1300">1300ml/h</option>
											<option value="1200">1200ml/h</option>
											<option value="1100">1100ml/h</option>
											<option value="1000">1000ml/h</option>
											<option value="900">900ml/h</option>
											<option value="800">800ml/h</option>
											<option value="700">700ml/h</option>
											<option value="600">600ml/h</option>
											<option value="500">500ml/h</option>
											<option value="400">400ml/h</option>
											<option value="300">300ml/h</option>
										</select>
									</td>
								</tr>
								<tr style="height:1rem">
									<td colspan="2"  style="padding:0 0 3px 0;border-top:0;opacity:0.6;font-size:0.72rem;font-style:italic;pointer-events:none"><span id="page2bolustext">Flash: assume bolus given instantaneously. Ideal for manual rapid bolus.</span></td>
								</tr>
								<tr style="height:2rem;padding-top:3px">
									<td style="padding:3px 0 0 0">Maintenance accuracy:</td>
									<td style="padding:3px 0 0 0">
										<select id="page2selectmaintenance">
											<option value="0">Auto</option>
											<option value="1">Lazy</option>
											<option value="2">Accurate</option>
										</select>
									</td>
								</tr>
								<tr style="height:1rem">
									<td colspan="2" style="padding:0;border-top:0;opacity:0.6;font-size:0.72rem;font-style:italic">Threshold for rate changes. Lazy: less frequent rate changes. Accurate: more frequent rate changes.</td>
								</tr>
							</table>
							<div style="width:100%;text-align:left">
								<a class="button invert wide" style="padding-right:0" id="page2proceed">Proceed</a>
								<a class="button muted right" onclick="pageTwoFunction();">Back</a>
								
							</div>
						</div>
					</div>

					<div id="complexmodeselection0" style="margin-top: 10px; border:2px solid #ccc; border-radius:9px;box-shadow:inset 0 4px 0 0 rgba(0,0,0,0.15); padding: 0px 5px;">
						<table class="" style="width:100%">
							<tr class="fr" style="height: 4rem; vertical-align:bottom">
								<td style="width:38%">						
									<div style="font-size: 10px; border-bottom: 2px solid rgb(255,210,80); transform:translateX(-7px); padding-left:7px; width: 50px; background: rgba(255,210,80,0.7)">Drug 1</div>
									<div style=" font-size: 20px; font-weight:bold;">PROPOFOL</div></td>
								<td>
									<select id="model_propofol">
										<option value="Marsh">Marsh</option>
										<option value="Schnider">Schnider</option>
										<option value="Paedfusor">Paedfusor</option>
										<option value="Eleveld" selected>Eleveld</option>
									</select>
								</td>
							</tr>

							<tr>
								<td>Infusion mode</td>
								<td>
									<select id="mode_propofol">
										<option value="0">CP Targeting</option>
										<option value="1" selected>CE Targeting</option>
										<option value="2">Manual</option>
										<option value="3">Intermittent Bolus</option>
									</select>
								</td>
							</tr>
						</table>
					</div>
					<div id="complexmodeselection1" style="margin-top: 10px;border:2px solid #ccc; border-radius:9px;box-shadow:inset 0 4px 0 0 rgba(0,0,0,0.15); padding: 0px 5px;">

						<table class="" style="width:100%">
							<tr class="fr" style="height: 4rem; vertical-align:bottom">
								<td style="width:38%">
									<div style="font-size: 10px; border-bottom: 2px solid rgb(0,129,255); transform:translateX(-7px); padding-left:7px; width: 50px; background: rgba(0,129,255,0.7)">Drug 2</div>
									<div style=" font-size: 20px; font-weight:bold; ">OPIOID</div>
								</td>
								<td>
									<select id="model_opioid" onchange="
										if (this.value==='Shafer') {
											document.getElementById('row_fen_weightadjusted1').style.display='table-row';
											document.getElementById('select_opioiddilution').value = 10;
										} else {
											if (this.value=='Maitre') {
												document.getElementById('select_opioiddilution').value = 100;
											} else {
												document.getElementById('select_opioiddilution').value = 20;
											}
											document.getElementById('row_fen_weightadjusted1').style.display='none';
										}
										document.getElementById('custom_opioiddilution').style.display = 'none';
									">
										<option value="Minto">Remifentanil (Minto)</option>
										<option value="Eleveld-Remifentanil">Remifentanil (Eleveld)</option>
										<option value="Maitre">Alfentanil (Maitre)</option>
										<option value="Shafer">Fentanyl (Shafer)</option>
									</select>
								</td>
							</tr>
							<tr id="row_opioiddilution"><td>Concentration</td>
								<td>
									<select id="select_opioiddilution" onchange="change_opioiddilution(this.value)">
										<option value="5">5mcg/ml</option>
										<option value="10">10mcg/ml</option>
										<option value="20" selected>20mcg/ml</option>
										<option value="25">25mcg/ml</option>
										<option value="40">40mcg/ml</option>
										<option value="50">50mcg/ml</option>
										<option value="100">100mcg/ml</option>
										<option value="custom">Custom</option>
									</select>
									<div id="custom_opioiddilution" onclick="
											if (document.getElementById('model_opioid').value == 'Shafer') {
												popup_dilution('opioiddilution','fentanyl');
											} else if (document.getElementById('model_opioid').value == 'Maitre') {
												popup_dilution('opioiddilution','alfentanil');
											} else {
												popup_dilution('opioiddilution','remifentanil');
											}
										">
										<span id="opioiddilution">_</span>mcg/ml
									</div>
								</td>
							</tr>
							<tr id="row_fen_weightadjusted1">
								<td>Weight adjusted?<!--<i class="far fa-question-circle tooltip3"><span class="tooltiptext">If YES: PK model adjusted to BW according to Shibutani, 2004; recommended for obese.</span></i>--></td>
								<td>
									<select id="select_fen_weightadjusted1">
										<option value="0" >No</option>
										<option value="1" selected>Yes</option>
									</select> 
								</td>
							</tr>
							<tr>
								<td>Infusion mode</td>
								<td>
									<select id="mode_opioid">
										<option value="0">CP Targeting</option>
										<option value="1" selected>CE Targeting</option>
										<option value="2">Manual</option>
										<option value="3">Intermittent Bolus</option>
									</select>
								</td>
							</tr>
						</table>
					</div>
					<div id="complexbuttons" style="padding-top:10px">
						<a class="button wide invert" id="btn_proceedComplex" onclick="proceedComplex();">Proceed</a>
						<a class="button wide muted right" id="btn_backComplex" onclick="toPageOne();">Back</a>
					</div>
				</div>
			</div>
		</div>
		<div id="modalLoad" class="modal">
			<div class="modal-content" id="modalLoadcontent">
				<div class="modal-header" id="modalLoadTitle">LOAD SIM FILE<span id="load_about_btn" style="display: inline" onclick="displayloadabout();"><i class="fas fa-question-circle"></i></span></div>
				<div class="modal-body" style="padding-bottom:0">
					<span id="modalLoadDescription">Select a SIM-FILE to load:</span>
					<div id="fileselection">
						<input type='file' id='myFile' onchange='previewFile()' style='width: 100%' accept='.csv,.CSV,text/csv'/>
					</div>
					<div id="loadfile_container">
					</div>
					<div id="modalLoadHugeButtons">
						Select source:
						<a class="button huge" style="width:100%" onclick="loadSourceExt();">IMPORT FROM EXTERNAL <i class="fas fa-file-csv fa-fw"></i></a>
						<div style="padding-left:12px"><i>This will import a previously saved SimTIVA database file (.csv)</i></div>
						<div style="height:20px"></div>
						<a class="button huge" style="width:100%" onclick="loadSourceLocal()">LOAD LOCAL SIMFILE <i class="fas fa-file-alt fa-fw"></i></a>
						<div style="padding-left:12px"><i>This will load sim-files saved on device. You can also manage & export local sim-files.</i></div>
						<div style="height:20px"></div>
						<div>&nbsp;<a class="button muted right" onclick="toPageOneFromLoad();">Back</a></div>
						<div style="height:30px"></div>
					</div>
					<div id="modalLoadNormalButtons">
						<a class="button wide invert" id="btn_load" onclick="init_rescue(selected_uid);">Load Selection</a>
						<a class="button muted right" onclick="toPageOneFromLoad();">Back</a>
						<a class="button muted right" id="btn_manageFiles" onclick="manageFileList();">Manage</a>
						<div><a class="button hide" id="btn_export" onclick="exportFunction()">Export all</a></div>
					</div>
					<div id="modalLoadImportButtons">
						<a class="button wide invert disabled" id="btn_load_import" onclick="init_rescue(selected_uid,true)">Load Selection</a> &nbsp;
						<a class="button muted right" onclick="toPageOneFromLoad();">Back</a>
					</div>
				</div>
			</div>
		</div>
		<div id="modalWarning" class="modal alt">
			<div class="modal-content alt" id="modalWarningcontent">
				<div class="modal-header alt"><span class="title">Please wait</span><span class="close alt" onClick="hidewarningmodal()">&times;</span></div>
				<div class="modal-body alt">SimTIVA is loading up...</div>
			</div>
		</div>
		<!-- start non-essential modals -->
		<div id="xModals">
		</div><!--end non-essential modals-->
		<!--endmodal--><!-- 
		start leftbar--><div id="xLeftbar"></div><!-- end leftbar
		--><div id="parallax3" style="opacity:0"></div>
    <div class="menuwrapper" id="menu">
        <div class="menucontent">
            <a href="#" onclick="displayAbout2(0); togglemenu();"><i class="fas fa-info-circle"></i>About</a>
            <a href="#" onclick="displayAbout2(); togglemenu();" ><i class="fas fa-question-circle"></i>Help</a>
            <a href="#" onclick="setmodal('modalReset'); togglemenu();"><i class="fas fa-sync-alt"></i>Reload</a>
            <a href="#" onclick="setmodal('modalDocumentation'); togglemenu();"><i class="fas fa-book"></i>Documentation</a>
            <a href="#" onclick="sharefunction(); togglemenu();"><i class="fas fa-share-alt"></i>Share</a>
            <a href="https://simtiva.blogspot.com/p/feedback.html" target="_blank" onclick="togglemenu();" ><i class="fas fa-comments"></i>Blog/Contact</a>            
        </div>
        <!--end of menucontent-->
        <div class="social">
        </div>
    	</div>

		<div class="installbutton" id="installbutton">
			<i class="fas fa-download fa-fw" style="transform: translateY(2px);"></i>
			<div class="installtext" id="installtext">INSTALL</div>
			<div class="installclose" id="installclose"><i class="fas fa-times fa-fw"></i></div>
		</div>

	<div id="bodywrapper" class="" style="opacity:0">
		<div class="hamburger"  id="hamburger" onclick="togglemenu();" style="display:none">
          <div class="bar1"></div>
          <div class="bar2"></div>
          <div class="bar3"></div>
    	</div>
		<div id="parallax2"><!-- arranged for swapping-->
		</div>
		<div id="parallax1">
			<div id="parallax1container" class="">
				<div class="displayleft">
					<div class="clockcontainer"><span id="clock">_</span></div>
					<div class="VIcontainer">VI: <span id="displayvolume">_</span>ml</div>
				</div><!--
				--><div class="displayright">
					<div class="displaywrapper">
						<div class="">
							<span id="drugname"></span> (<span id="modelname"></span>)
							
						</div>
						<div><b>BW:<span id="bw"></span></b>, BH:<span id="bh"></span></div>
						<div><span id="age"></span>, <span id="gender"></span><!--<span id="temptimedisplay" style="float:right; opacity:50%"></span>--></div>
					</div>
				</div>
			</div>
		</div>


		
		<div id="popupchartdiv" style="display: none;position:fixed;background:black;top:0;left:0;z-index:96;width:100%;height:100%;padding:0">

			<!--start numpad -->
			<div id="numpadContainer">
				<div id="numpadTitle">
					Numpad
				</div>
				<div id="numpadBody">
					<div id="numpadOutput">
						<div id="numpadOutputDisplayMinus" onclick="step(this.id)"><i class="fas fa-minus-circle"></i></div>
						<div id="numpadOutputDisplay">123</div>
						<div id="numpadOutputDisplayPlus" onclick="step(this.id)"><i class="fas fa-plus-circle"></i></div>
					</div>
					<div id="numpadInput">
						<div class="numkeyRow">
							<div class="numkey" id="7" onclick="keypress(this.id)">7</div>
							<div class="numkey" id="8" onclick="keypress(this.id)">8</div>
							<div class="numkey" id="9" onclick="keypress(this.id)">9</div>
						</div>
						<div class="numkeyRow">
							<div class="numkey" id="4" onclick="keypress(this.id)">4</div>
							<div class="numkey" id="5" onclick="keypress(this.id)">5</div>
							<div class="numkey" id="6" onclick="keypress(this.id)">6</div>
						</div>
						<div class="numkeyRow">
							<div class="numkey" id="1" onclick="keypress(this.id)">1</div>
							<div class="numkey" id="2" onclick="keypress(this.id)">2</div>
							<div class="numkey" id="3" onclick="keypress(this.id)">3</div>
						</div>
						<div class="numkeyRow">
							<div class="numkey" id="funcDot" onclick="decimal()">.</div>
							<div class="numkey" id="0" onclick="keypress(this.id)">0</div>
							<div class="numkey" id="funcBackspace" onclick="backspace();"><i class="fas fa-backspace"></i></div>
						</div>
						<div class="numkeyRow">
							<div class="numkey special" id="btn_confirm_numpad">Enter</div>
							<div class="numkey special" onclick="resetNumpad();">Reset</div>
							<div class="numkey special" onclick="cancelNumpad();">Cancel</div>
						</div>
					</div>
				</div>
			</div>

			<div id="numpadPreview">
				<div>Preview:</div>
				<div id="numpad_preview_msg">Waiting for input</div>
			</div>
			<!--
			<div id="numpadManual">
				<div id="bolusButtonContainer">
					<a class="button bolus" id="numpadBolus3"></a>
					<a class="button bolus" id="numpadBolus2"></a>
					<a class="button bolus" id="numpadBolus1"></a>
				</div>
			</div>
			-->
			<div id="numpadLine">
			</div>
			<div id="numpadBackground">
			</div>

			<!--end numpad -->

				<div id="chartinfooverlay" class="">
					<div id="chartinfoleft" onclick="togglePopupInfo();"><i class="fas fa-chevron-circle-right fa-fw"></i></div><!--
					--><div id="chartinforight">
						<div id="chartinfotime"><span id="timecopy" class="timespan">0m 0s</span></div>
						<div id="chartinfodrugline1"><span id="drugnamecopy">DRUG</span><span id="modelnamecopy"></span><span id="conccopy">(_mg/ml)</span></div>
						<div id="chartinfodrugline2">Awaiting input</div>
						<div id="chartinfoscheme"><span id="nextratedescriptor">Rate info unavailable </span><span id="nextratecopy"></span><span id="nextratepreposition"></span><span id="timeremaincopy"></span></div>
						<div id="chartinfoptol">PTOL: __</div>
					</div>
				</div>
				<div id="chartoverlayoptions2" >
					<div id="chartoverlayoptions2content">
						<div id="closeoptions2" onclick="togglepopupoptions();">&times;</div>
						<div id="" style="font-weight:bold; margin-top:6px; margin-bottom:7px">Chart Options</div>
						<div id="chartoptionscheckbox2">
				      <label class="container labeloptionscontainer" style="">Automatic time scale
				          <input type="checkbox" id="isTimeAutomatic2" onChange="toggleautotime();" checked><span class="checkmark"></span>
				      </label>
						</div>
						<div style="padding-left:30px">Custom time range (min):</div>
						<div id="timerangeslider2">
							<div id="leftslidercontainer2">
								<input id="range0copy" value="10" min="0" max="30" step="5" type="range" oninput="processrange(0);">
								<div class="timerangetext" id="rangetext0copy">0</div>
							</div>
							<div id="rightslidercontainer2">
								<input id="range1copy" value="90" min="30" max="120" step="5" type="range" oninput="processrange(1);">
								<div class="timerangetext" id="rangetext1copy">30</div>
							</div>		
						</div>
						<div style="margin-top:30px" id="PD_options_group2">
				      <label class="container labeloptionscontainer" style="margin-bottom:0px">PD Effect estimation
				          <input type="checkbox" id="isEffectEstimationOn2" onChange="if (document.getElementById('isEffectEstimationOn').checked == true) {document.getElementById('isEffectEstimationOn').checked = false} else {document.getElementById('isEffectEstimationOn').checked = true;}toggleEffectEst();" checked><span class="checkmark"></span>
				      </label>
				      <select id="select_effect_measure2" style="margin-left:30px;width:calc(100% - 30px)" onChange="document.getElementById('select_effect_measure').value=document.getElementById('select_effect_measure2').value;toggleEffectEst();">
				      	<option value="bis">BIS 40-60</option>
				      	<option value="ptol">PTOL 50-90</option>
				      	<option value="nsri">NSRI 20-50</option>
				      </select>
						</div>
					</div>
					<div id="chartoverlayoptionscontentarrow2"></div>
				</div>
			<div id="popupchartcontainer" style="width:100%;height:100%;display:block;border-radius:1rem">
				<div style="display:inline-block;width:calc(100% - 108px);height:100%;"><canvas id="popupchart"></canvas></div><!--
				--><div style="display:inline-block;width:108px;vertical-align:top;padding:10px;height:100%">
						<div style="background:#198964; border-radius:0rem 1rem 1rem 1rem;height:100%"> 
							<!--right container-->
							<div class="pop_right_elem">
								<a class="pop_button" id="pop_button_close" onclick="destroypopup();">
									<i class="fas fa-times"></i>
								</a>
							</div>

							<div class="pop_right_elem">
								<div class="pop_title_box cp" id="pop_cp"><span id="cp_copy">-</span></div>
							</div>
							<div id="pop_right_edit_cp">
								Edit CpT
							</div>
							<div class="pop_right_elem">
								<div class="pop_title_box ce" id="pop_ce"><span id="ce_copy">-</span></div>
							</div>
							<div id="pop_right_edit_ce">
								Edit CeT
							</div>
							<div class="pop_right_elem">
								<div class="pop_title_box infrate" id="pop_infrate"><span id="infrate_copy">-</span></div>
							</div>


						
							<a class="pop_button" id="pop_button_options" onclick="togglepopupoptions();">
								<i class="fas fa-cog"></i>
							</a>

						</div>

				</div>
			</div>
		</div>

		<div id="controlpanel">
			<div id="prompts_container">
				<div class="prompts_card" id="warning" style="border-color:#e4c4c4">
					<div class="prompts_close" onclick="hide_prompts(this.parentElement); user_hide = 1; userhide();"><i class="fas fa-times-circle"></i></div>
					<div id="warningleft"><i class="fas fa-exclamation-circle" id="warningicon"></i></div>
					<div id="warningright">
						<div style="font-size:80%; font-weight:bold; color:red; border-bottom:1px solid #e4c4c4; padding-bottom:2px"><span id="warningdescriptor">REMINDER - next change in </span><div id="warningcounter">10s</div></div>
						<div style="" id="warningprompt">_</div>
					</div>
				</div>
				<div class="prompts_card" id="preview" style="border-color:#a9c5e4">
					<div class="prompts_close" onclick="hide_prompts(this.parentElement)"><i class="fas fa-times-circle"></i></div>
					<div id="previewleft"><i class="fas fa-arrow-circle-up" id="previewicon"></i></div>
					<div id="previewright">
						<div style="font-size:0.8rem; font-weight:bold; border-bottom:1px solid #a9c5e4; padding-bottom:2px; line-height:1.2">PREVIEW: To achieve target <div id="preview_cpt"></div></div>
						<div style="line-height:1.2;padding-top:2px;font-size:0.9rem" id="preview_msg"></div>
					</div>
				</div>
				<div class="" id="preview-expand-button" onclick="displaypreview_expand();"><i class="fas fa-angle-double-down"></i> &nbsp; <span>EXPAND</span></div>
				<div class="" id="preview-expand-box"></div>
				<div class="prompts_card" id="prompt" style="border-color:#9bc99d">
					<div id="promptleft"><i class="fas fa-info-circle" id="prompticon"></i></div>
					<div id="promptright">
						<div style="font-size:80%; font-weight:bold; border-bottom:1px solid #9bc99d; padding-bottom:2px"><span id="prompt_msg2">Current rate</span></div>
						<div id="progressbar"></div>
						<div style="" id="prompt_msg"><span id="status">Waiting to start</span><span id="infusiondescriptor"></span></div>
					</div>
				</div>
			</div>

			<div class="cardscontainer">

		<!-- start input cards -->
		<div id="xInputCards">
		</div>
		<!-- end of input cards -->
		<div id="outputcontainer">
			<div id="outputselector">
				<a class="outputtab active" id="btn_displaychart" onclick="show_graph();">Graph</a>
				<a class="outputtab" id="btn_displayhistory" onclick="show_history();">History</a>
			</div>
			<div id="chartwrapper">
				<div id="chartoverlay">
					<div id="chartoverlaytext">Updating chart...</div>
				</div>
				<div id="chartbuttons">
					<a id="chartzoomin" onclick="chartZoomToggle(1);"><i class="fas fa-search-plus"></i></a>
					<a id="chartoptions" onclick="chartOptionsToggle();"><i class="fas fa-cog"></i></a>
					<a id="chartzoomout" onclick="chartZoomToggle(0);"><i class="fas fa-search-minus"></i></a>
				</div>
				<div id="chartoverlayoptions">
					<div id="chartoverlayoptionscontent">
						<div id="closeoptions" onclick="chartOptionsToggle();">&times;</div>
						<div id="" style="font-weight:bold; margin-top:5px; margin-bottom:5px">Chart Options</div>
						<div id="chartoptionscheckbox">
				      <label class="container labeloptionscontainer" style="">Display events
				          <input type="checkbox" onChange="toggleshowevents();" id="isShowEvents" checked><span class="checkmark"></span>
				      </label>
				      <label class="container labeloptionscontainer" style="">Automatic time scale
				          <input type="checkbox" id="isTimeAutomatic" onChange="toggleautotime();" checked><span class="checkmark"></span>
				      </label>
						</div>
						<div style="padding-left:30px">Custom time range (min):</div>
						<div id="timerangeslider">
							<div id="leftslidercontainer">
								<input id="range0" value="10" min="0" max="30" step="5" type="range" oninput="processrange(0);">
								<div class="timerangetext" id="rangetext0">0</div>
							</div>
							<div id="rightslidercontainer">
								<input id="range1" value="90" min="30" max="120" step="5" type="range" oninput="processrange(1);">
								<div class="timerangetext" id="rangetext1">30</div>
							</div>		
						</div>
						<div style="margin-top:30px" id="PD_options_group">
				      <label class="container labeloptionscontainer" style="margin-bottom:0px">PD Effect estimation
				          <input type="checkbox" id="isEffectEstimationOn" onChange="toggleEffectEst();" checked><span class="checkmark"></span>
				      </label>
				      <select id="select_effect_measure" style="margin-left:30px;width:calc(100% - 30px)" onChange="toggleEffectEst();">
				      	<option value="bis">BIS 40-60</option>
				      	<option value="ptol">PTOL 50-90</option>
				      	<option value="nsri">NSRI 20-50</option>
				      </select>
						</div>
					</div>
					<div id="chartoverlayoptionscontentarrow"></div>
				</div>
				<div id="annotatebutton" style="display:none" onclick="setnow(Math.floor(time_in_s));document.getElementById('modalAnnotatetitle').innerHTML='ADD EVENT';document.getElementById('addeventtext').value='';document.getElementById('btn_submitevent').setAttribute('onclick','createEvent2(-1)');document.getElementById('btn_deleteevent').style.display='none';setmodal('modalAnnotate')">
					<i class="fas fa-pencil-alt"></i>
				</div>
				<div id="expandbutton" style="display:none" onclick="openpopupchart();">
					<i class="fas fa-expand-alt"></i>
				</div>
				<div id="chartcontainer">
					<canvas id="myChart"></canvas>
				</div>
			</div>
			<div id="historywrapper2">
				<div id="historywrapper">
				</div>
			</div>
				<div id="pastscheme">
					<a id="pastschemebutton" onclick="displaymodalhistory();"><i class="fas fa-history"></i> Past Schemes</a>
				</div>
		</div>
		<div id="eventscontainer" style="display:block">
		</div>
		<div id="xCards"><!-- start of non-essnetial cards-->
		</div><!-- end of non-essential cards section-->
		<div class="card" id="card_options">
			<div class="cardtitle">OPTIONS</div>
			<div class="cardcontents">

    		<div class="optionscardtitle collapsiblecard">INFUSION SETTINGS</div>
    		<div class="optionscardcontents">
				<div id="ptolcardoptions">
	      			<label class="container labelptolcontainer" style="">Display detailed tab info
	          		<input type="checkbox" onChange="toggleshowtabinfo();" id="isTabInfo"><span class="checkmark"></span>
	      			</label>
	      <!--<label class="container labelptolcontainer" style="">Display effective dose margins <span style='font-size: 80%'>(PTOL50-90)</span>
	          <input type="checkbox" id="" onChange="toggleshowPTOLmargins();" checked><span class="checkmark"></span>
	      </label>
	    -->
	    		</div>
				<table class="table-control">
					<!--options array-->
					<!-- 
					0[0:mg/kg/h, 1:mcg/kg/min],
					1[0:1x, 1:5x, 2:25x, 3:50x],
					2[0:auto, 1:lazy, 2:accurate],
					3[0:wakelockoff, 1:wakelockon],
					4[0:vibrateoff, 1:vibrateon],
					5[0:soundoff, 1:soundon],
					6[0:notifoff, 1:notifon]

					default is:
					[1,0],
					[1,0,0,0],
					[1,0,0],
					[1,0],
					[1,0],
					[1,0],
					[1,0]
					-->
					<!--end options array-->
					<tr id="option_bolusspeed_row" style="display:none" class="fr"><td>Max bolus speed <i class="fas fa-question tooltip background ring"><span class="tooltiptext">Max bolus rate for programmed bolus. Flash means instantaneous bolus.</span></i></td>
						<td>
							<select id="select_bolusspeed" onchange="applybolusspeed();">
											<option value="0" selected>Flash</option>
											<option value="1500">1500ml/h</option>
											<option value="1400">1400ml/h</option>
											<option value="1300">1300ml/h</option>
											<option value="1200">1200ml/h</option>
											<option value="1100">1100ml/h</option>
											<option value="1000">1000ml/h</option>
											<option value="900">900ml/h</option>
											<option value="800">800ml/h</option>
											<option value="700">700ml/h</option>
											<option value="600">600ml/h</option>
											<option value="500">500ml/h</option>
											<option value="400">400ml/h</option>
											<option value="300">300ml/h</option>
							</select>
						</td>
					</tr>
					<tr id="option_threshold_row" class="fr"><td style="letter-spacing:-0.5px;font-stretch:90%">Maintenance accuracy <i class="fas fa-question tooltip background ring"><span class="tooltiptext" style="width:170px">Threshold of CPT/CET schemes. Lazy: less frequent rate changes. Accurate: more frequent changes.</span></i></td>
						<td>
							<select id="select_threshold">
								<option value="0">Auto</option>
								<option value="1">Lazy</option>
								<option value="2">Accurate</option> <!--0.13, 0.565-->
							</select>
						</td>
					</tr>
					<tr id="option_unit_row"><td>Unit for propofol <i class="fas fa-question tooltip background ring"><span class="tooltiptext" style="width:160px">Secondary unit for propofol infusion rate apart from ml/h. Refresh your CPT/CET target after change.</span></i></td>
						<td>
							<select id="select_unit">
								<option value="mgh">mg/kg/h</option>
								<option value="mcgmin">mcg/kg/m</option>
							</select>
						</td>
					</tr>
					<tr class="" id="option_defaultrateunit"><td>Default rate unit <i class="fas fa-question tooltip background ring"><span class="tooltiptext" style="width:160px">Unit for entering manual mode infusion rate, e.g. "ml/h" vs "mg/kg/h" (or appropriate units)</span></i></td>
						<td>
							<select id="select_defaultrateunit">
								<option value="mlh">ml/h</option>
								<option value="unitkgtime">mg/kg/h</option>
							</select>
						</td>
					</tr>
					<tr class="" id="option_defaultbolusunit"><td>Default bolus unit <i class="fas fa-question tooltip background ring"><span class="tooltiptext" style="width:160px">Unit for entering manual mode bolus, e.g. "mg" vs "mg/kg" vs "ml" (or appropriate units)</span></i></td>
						<td>
							<select id="select_defaultbolusunit">
								<option value="mg">mg</option>
								<option value="mgkg">mg/kg</option>
								<option value="ml">ml</option>
							</select>
						</td>
					</tr>
					<tr id="option_simspeed_row"><td>Simspeed</td>
						<td>
							<select id="select_simspeed">
								<option value="1">1x (Normal)</option>
								<option value="5">5x (Fast)</option>
								<option value="25">25x (Very fast)</option>
								<option value="50">50x (Super fast)</option>
							</select>
						</td>
					</tr>
				</table>
			</div><!-- end infusion settings -->
			<div class="optionscardtitle collapsiblecard">PROGRAM FEATURES</div>
			<div class="optionscardcontents"><!-- start prograam features -->
				<table class="table-control">
					<tr class="fr"><td>Wakelock <i class="fas fa-question tooltip background ring"><span class="tooltiptext">Keeps screen on. Experimental. Android & some desktop devices only.</span></i></td>
						<td>
							<select id="select_wakelock">
								<option value="off">Off</option>
								<option value="on">On</option>
							</select>
						</td>
					</tr>
					<tr><td>Vibrate</td>
						<td>
							<select id="select_vibrate">
								<option value="off">Off</option>
								<option value="on">On</option>
							</select>
						</td>
					</tr>
					<tr><td>Sound</td>
						<td>
							<select id="select_sound">
								<option value="off">Off</option>
								<option value="on">On</option>
							</select>
						</td>
					</tr>

					<tr><td>Notifications</td>
						<td>
							<select id="select_notification">
								<option value="off">Off</option>
								<option value="on">On</option>
							</select>
						</td>
					</tr>
				</table>
			</div>
				<a class="button" id="btn_apply" onclick="applyoptions();">Apply</a>
				<a class="button right muted" id="btn_defaultoptions" onclick="loadoptions('default');loadoptions();applyoptions();">Reset settings</a>
				<!--
				<a class="button" id="btn_test_alert" onclick="testalert();">Test alert</a>
				<a class="button" id="btn_test_alertoff" onclick="testalertoff();">Alert Off</a>
				-->
			</div>
		</div>
		</div><!--end cards container layout-->
		<div class="bottomcard">
			<h1>SimTIVA is a computer simulation program to simulate delivery of total intravenous anaesthesia (TIVA) using a target-controlled infusion (TCI) pump. This progressive web app (PWA) is designed for use on smartphones, tablets and computers.</h1>
		</div>

		</div><!--controlpanel-->
		<div id="cornerblock" style="">
			<div style="" id="cornerblock2">
				<div id="cornermessage"></div>
				<div class="cornericon" id="sharebutton" onclick="sharefunction()"><i class="fas fa-share-alt fa-fw"></i></div>
				<div class="cornericon" id="darkmodebutton" onclick="goDark();"><i class="fas fa-moon fa-fw"></i></div>
			</div>
		</div>
		<div class="suspendbanner" id="suspendBanner">
			<div style="padding-top:20px;font-weight:bold;color:white">Simulation is suspended.</div>
		</div>
		<div class="warningbanner" id="warningBanner">
			<div class="warningbanner_left">
				<i class="fas fa-exclamation-triangle"></i>
			</div>
			<div class="warningbanner_right">
				<div class="warningbanner_up"><b>WARNING</b> - Time's up!</div>
				<div class="warningbanner_down">
					<div id="warningmessage">Simulation session expiring in &lt;10 mins. Do you want to continue using SimTIVA?</div>
					<div id="warningbuttondiv"><a class="button muted" id="warningbutton" onclick="">Yes</a>
					</div>
				</div>
			</div>
		</div>
		<div id="logo2" style="">
			<div style="font-weight:bold; letter-spacing:2px; font-stretch:110%; text-shadow:1px 1px 2px #0005">SimTIVA <span style="opacity:0.3">| Terence Luk 2024</span></div>
		</div>
	</div><!--bodywrapper-->
	
	<script src="main.js"></script>
	<script src="pharmacology.js" defer></script>
	<script src="index.js" defer></script>
	<script src="features.js" defer></script>
	<script src="lz-string.js" defer></script>


	<script>init();</script>
	<script>


// Function that attempts to request a screen wake lock.
let wakeLock = null; //sentinel
const requestWakeLock = async () => {
  try {
    wakeLock = await navigator.wakeLock.request();
    wakeLock.addEventListener('release', () => {
      console.log('Screen Wake Lock released:', wakeLock.released);
    });
    console.log('Screen Wake Lock released:', wakeLock.released);
  } catch (err) {
    console.error(`${err.name}, ${err.message}`);
  }
};
//check for support
if (!('wakeLock' in navigator)) {
	document.getElementById("select_wakelock").disabled = true;
}


document.addEventListener('visibilitychange', async () => {
  const val = document.getElementById("select_wakelock").value;
  if (wakeLock !== null && document.visibilityState === 'visible' && val == "on") {
    requestWakeLock();
  }
});


// Function for custom install prompt

let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent the mini-infobar from appearing on mobile
  e.preventDefault();
  // Stash the event so it can be triggered later.
  deferredPrompt = e;
  // Update UI notify the user they can install the PWA
  //showInstallPromotion();
  // Optionally, send analytics event that PWA install promo was shown.
  console.log(`'beforeinstallprompt' event was fired.`);
});

window.addEventListener('appinstalled', () => {
  // Hide the app-provided install promotion
  hideInstallPromotion();
  // Clear the deferredPrompt so it can be garbage collected
  deferredPrompt = null;
  // Optionally, send analytics event to indicate successful install
  console.log('PWA was installed');
});

var t = null;

function showInstallPromotion() {
	if (deferredPrompt != undefined) {
	installbutton = document.getElementById("installbutton");
	installbutton.classList.add("show");
	clearTimeout(t);
	t = setTimeout(function() {
			installbutton.classList.add("hidebutton");
			installbutton.classList.remove("show");
		},30*1000);
	}
}

document.getElementById("installtext").addEventListener('click', async () => {
	hideInstallPromotion();
	deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  // Optionally, send analytics event with outcome of user choice
  console.log(`User response to the install prompt: ${outcome}`);
  // We've used the prompt, and can't use it again, throw it away
  deferredPrompt = null;
});

document.getElementById("installclose").addEventListener('click', function() {
	hideInstallPromotion();
	console.log('user click close install btn');
  deferredPrompt = null;
});

function hideInstallPromotion() {
	document.getElementById("installbutton").classList.remove("show");
}

	</script>
	<!-- chart.js from https://cdnjs.com/libraries/Chart.js-->
	<script src="chart.min.js" defer></script>
	<script src="chartjs-plugin-crosshair.min.js" defer></script>
	<script>

	</script>
</body>
</html>
